<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>用户设置 - 校园论坛</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/settings.css">
  <!-- highlight.js 主题 -->
  <link rel="stylesheet" href="/libs/highlight.js/styles/github.min.css">
</head>
<body>
  <header>
    <div class="header-content">
      <div class="logo">
        <i class="fas fa-comments"></i>
        <h1>校园论坛</h1>
      </div>
      <div class="notification-area" id="notificationArea"></div>
      <div id="user-actions">
        <!-- 用户头像（登录后显示） -->
        <div id="header-user-avatar" class="header-user-avatar" style="display: none;">
          <i class="fas fa-user-circle"></i>
          <div class="header-user-dropdown">
            <div class="header-user-info">
              <div class="header-user-name" id="header-username">用户名</div>
              <div class="header-user-class" id="header-user-class">班级信息</div>
            </div>
            <div class="header-user-menu">
              <a href="profile.html" class="header-menu-item">
                <i class="fas fa-user"></i> 个人资料
              </a>
              <a href="settings.html" class="header-menu-item">
                <i class="fas fa-cog"></i> 设置
              </a>
              <a href="message.html" class="header-menu-item">
                <i class="fas fa-bell"></i> 消息
              </a>
              <div class="header-menu-divider"></div>
              <button id="header-logout-btn" class="header-menu-item logout">
                <i class="fas fa-sign-out-alt"></i> 退出登录
              </button>
            </div>
          </div>
        </div>
        
        <!-- 登录/注册按钮（未登录时显示） -->
        <button id="login-btn"><i class="fas fa-sign-in-alt"></i> 登录</button>
        <button id="register-btn"><i class="fas fa-user-plus"></i> 注册</button>
      </div>
    </div>
  </header>
  
  <div class="container">
    <div class="main-content">
      <div>
        <!-- 返回按钮 -->
        <div class="back-button-container">
          <button onclick="window.location.href='index.html'" class="back-button">
            <i class="fas fa-arrow-left"></i> 返回首页
          </button>
        </div>
        
        <!-- 设置标题 -->
        <div class="settings-header">
          <h1 class="section-title">
            <i class="fas fa-cog"></i> 用户设置
          </h1>
          <p class="settings-subtitle">管理您的账户偏好和个性化设置</p>
        </div>
        
        <!-- 设置内容 -->
        <div class="settings-content">
          <!-- 主题设置 -->
          <div class="settings-card">
            <h2 class="settings-card-title">
              <i class="fas fa-palette"></i> 主题设置
            </h2>
            <p class="settings-card-description">选择您偏好的界面主题，切换明暗模式</p>
            
            <div class="theme-selection">
              <!-- 经典主题 -->
              <div class="theme-option" data-theme="light">
                <div class="theme-preview light-theme">
                  <div class="theme-header"></div>
                  <div class="theme-content">
                    <div class="theme-card"></div>
                    <div class="theme-card"></div>
                  </div>
                </div>
                <div class="theme-label">
                  <i class="fas fa-sun"></i> 浅色模式
                </div>
                <div class="theme-description">浅色主题，适合白天使用</div>
              </div>
              
              <div class="theme-option" data-theme="dark">
                <div class="theme-preview dark-theme">
                  <div class="theme-header"></div>
                  <div class="theme-content">
                    <div class="theme-card"></div>
                    <div class="theme-card"></div>
                  </div>
                </div>
                <div class="theme-label">
                  <i class="fas fa-moon"></i> 深色模式
                </div>
                <div class="theme-description">深色主题，适合夜间使用</div>
              </div>
              
              <div class="theme-option" data-theme="auto">
                <div class="theme-preview auto-theme">
                  <div class="theme-header"></div>
                  <div class="theme-content">
                    <div class="theme-card"></div>
                    <div class="theme-card"></div>
                  </div>
                </div>
                <div class="theme-label">
                  <i class="fas fa-sync-alt"></i> 自动切换
                </div>
                <div class="theme-description">根据系统设置自动切换</div>
              </div>
            </div>
            
            <div class="theme-actions">
              <button id="apply-theme" class="settings-button primary">
                <i class="fas fa-check"></i> 应用主题
              </button>
              <button id="reset-theme" class="settings-button secondary">
                <i class="fas fa-undo"></i> 恢复默认
              </button>
            </div>
            
            <!-- 主题应用状态显示 -->
            <div id="theme-save-status" class="save-status"></div>
          </div>
          
          <!-- 账户设置 -->
          <div class="settings-card">
            <h2 class="settings-card-title">
              <i class="fas fa-user-edit"></i> 账户设置
            </h2>
            <p class="settings-card-description">管理您的账户信息和个性化资料</p>
            
            <!-- 头像上传部分 -->
            <div class="avatar-upload-section">
              <div class="avatar-preview-container">
                <img id="avatar-preview" src="/images/default-avatar.svg" alt="头像预览" class="avatar-preview">
                <div class="avatar-overlay">
                  <i class="fas fa-camera"></i>
                  <span>更换头像</span>
                </div>
              </div>
              <div class="avatar-upload-actions">
                <input type="file" id="avatar-upload" accept="image/*" style="display: none;">
                <button type="button" class="settings-button secondary" id="upload-avatar-btn">
                  <i class="fas fa-upload"></i> 上传头像
                </button>
                <button type="button" class="settings-button danger" id="remove-avatar-btn" style="display: none;">
                  <i class="fas fa-trash"></i> 移除头像
                </button>
              </div>
              <div class="avatar-upload-tips">
                <small class="form-hint">支持 JPG、PNG、GIF 格式，建议尺寸 200x200 像素，大小不超过 2MB</small>
              </div>
            </div>
            
            <form id="account-form" class="settings-form">
              <div class="form-group">
                <label for="username">
                  <i class="fas fa-user"></i> 昵称
                </label>
                <input type="text" id="username" name="username" placeholder="请输入您的昵称" required>
                <small class="form-hint">昵称将在论坛中显示给其他用户</small>
              </div>
              
              <div class="form-group">
                <label for="current-password">
                  <i class="fas fa-lock"></i> 当前密码
                </label>
                <input type="password" id="current-password" name="currentPassword" placeholder="请输入当前密码">
                <small class="form-hint">仅当修改密码时需要填写</small>
              </div>
              
              <div class="form-group">
                <label for="new-password">
                  <i class="fas fa-key"></i> 新密码
                </label>
                <input type="password" id="new-password" name="newPassword" placeholder="请输入新密码">
                <small class="form-hint">留空表示不修改密码，建议使用包含字母、数字和符号的组合</small>
                <div class="password-strength">
                  <div id="password-strength" class="strength-meter"></div>
                </div>
              </div>
              
              <div class="form-group">
                <label for="confirm-password">
                  <i class="fas fa-key"></i> 确认新密码
                </label>
                <input type="password" id="confirm-password" name="confirmPassword" placeholder="请再次输入新密码">
              </div>
              
              <div class="form-actions">
                <button type="submit" class="settings-button primary" id="save-account">
                  <i class="fas fa-save"></i> 保存账户设置
                </button>
                <button type="button" class="settings-button secondary" id="cancel-account">
                  <i class="fas fa-times"></i> 取消
                </button>
              </div>
              
              <!-- 保存状态显示 -->
              <div id="account-save-status" class="save-status"></div>
            </form>
          </div>
          
          <!-- 预留扩展区域 -->
          <div class="settings-card">
            <h2 class="settings-card-title">
              <i class="fas fa-plus-circle"></i> 更多设置
            </h2>
            <p class="settings-card-description">更多个性化功能正在开发中</p>
            
            <div class="placeholder-section">
              <div class="placeholder-item">
                <i class="fas fa-bell"></i>
                <div>
                  <h3>通知设置</h3>
                  <p>管理邮件和推送通知偏好</p>
                </div>
                <span class="coming-soon">即将推出</span>
              </div>
              
              <div class="placeholder-item">
                <i class="fas fa-language"></i>
                <div>
                  <h3>语言设置</h3>
                  <p>切换界面显示语言</p>
                </div>
                <span class="coming-soon">即将推出</span>
              </div>
              
              <div class="placeholder-item">
                <i class="fas fa-eye"></i>
                <div>
                  <h3>隐私设置</h3>
                  <p>控制个人资料的可见性</p>
                </div>
                <span class="coming-soon">即将推出</span>
              </div>
              
              <div class="placeholder-item">
                <i class="fas fa-download"></i>
                <div>
                  <h3>数据导出</h3>
                  <p>导出您的个人数据和帖子</p>
                </div>
                <span class="coming-soon">即将推出</span>
              </div>
              
              <div class="placeholder-item">
                <i class="fas fa-code"></i>
                <div>
                  <h3>代码编辑器主题</h3>
                  <p>自定义代码高亮和编辑器主题</p>
                </div>
                <span class="coming-soon">即将推出</span>
              </div>
              
              <div class="placeholder-item">
                <i class="fas fa-font"></i>
                <div>
                  <h3>字体设置</h3>
                  <p>调整界面字体大小和样式</p>
                </div>
                <span class="coming-soon">即将推出</span>
              </div>
              
              <div class="placeholder-item">
                <i class="fas fa-columns"></i>
                <div>
                  <h3>布局设置</h3>
                  <p>自定义论坛界面布局</p>
                </div>
                <span class="coming-soon">即将推出</span>
              </div>
            </div>
            
            <!-- 扩展提示 -->
            <div class="expansion-note">
              <i class="fas fa-lightbulb"></i>
              <p>更多个性化功能正在开发中，如果您有功能建议，欢迎在论坛中提出！</p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 侧边栏 -->
      <div class="sidebar">
        <!-- 设置导航 -->
        <div class="settings-nav-card">
          <h2 class="section-title">设置导航</h2>
          <ul class="settings-nav">
            <li class="nav-item active">
              <a href="#theme">
                <i class="fas fa-palette"></i> 主题设置
              </a>
            </li>
            <li class="nav-item">
              <a href="#account">
                <i class="fas fa-user-edit"></i> 账户设置
              </a>
            </li>
            <li class="nav-item">
              <a href="#notifications">
                <i class="fas fa-bell"></i> 通知设置
              </a>
            </li>
            <li class="nav-item">
              <a href="#privacy">
                <i class="fas fa-eye"></i> 隐私设置
              </a>
            </li>
            <li class="nav-item">
              <a href="#data">
                <i class="fas fa-download"></i> 数据管理
              </a>
            </li>
          </ul>
        </div>
        
        <!-- 帮助卡片 -->
        <div class="help-card">
          <h2 class="section-title">
            <i class="fas fa-question-circle"></i> 设置帮助
          </h2>
          <div class="help-content">
            <h3>主题设置</h3>
            <p>选择您偏好的界面主题。深色模式适合夜间使用，可以减轻眼睛疲劳。</p>
            
            <h3>账户安全</h3>
            <p>定期修改密码可以增强账户安全性。建议使用包含字母、数字和符号的复杂密码。</p>
            
            <h3>数据保存</h3>
            <p>您的设置会自动保存到服务器。即使更换设备，您的偏好设置也会保留。</p>
          </div>
        </div>
        
        <!-- 通知 -->
        <div class="notification">
          <i class="fas fa-info-circle"></i> 
          提示：所有设置更改会立即生效，部分设置可能需要刷新页面。
        </div>
      </div>
    </div>
  </div>
  
  <!-- 图片预览模态框 -->
  <div id="image-modal" class="image-modal">
    <div class="image-modal-content">
      <img src="" alt="预览图片">
    </div>
    <div class="image-modal-close">&times;</div>
  </div>
  
  <script src="js/utils.js"></script>
  <script src="js/user.js"></script>
  <script src="js/settings.js" onerror="console.error('settings.js 加载失败！')"></script>
  <script>
    console.log('scripts 加载完成');
    console.log('typeof settingsManager:', typeof settingsManager);
  </script>
  <script>
    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOMContentLoaded 事件触发');
      
      // 初始化用户管理
      userManager.init();
      
      // 等待一小段时间确保用户数据加载完成
      setTimeout(() => {
        console.log('开始初始化设置页面');
        console.log('typeof settingsManager:', typeof settingsManager);
        
        // 初始化设置页面
        if (typeof settingsManager === 'object' && settingsManager !== null) {
          settingsManager.init();
        } else {
          console.error('settingsManager 未定义！');
        }
        
        // 设置登录/注册按钮事件
        userManager.setupEventListeners();
      }, 100);
    });
  </script>
</body>
</html>